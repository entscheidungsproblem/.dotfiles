#!/usr/bin/env bash

# Easy extract
if [ -z "$1" ]; then
  # display usage if no parameters given
  echo "Usage: extract <path/file_name>.<zip|rar|bz2|gz|tar|tbz2|tgz|Z|7z|xz|ex|tar.bz2|tar.gz|tar.xz>"
  echo "       extract <path/file_name_1.ext> [path/file_name_2.ext] [path/file_name_3.ext]"
  return 1
else
  for n in $@
  do
    local filename=$(basename "$n")
    local foldername="${filename%%.*}"
    local fullpath=`perl -e 'use Cwd "abs_path";print abs_path(shift)' "$1"`
    local overwrite=true
    if [ -d "$foldername" ]; then
      vared -h -p "$foldername already exists, do you want to overwrite it? (y/n) " -c reply 
      if [[ "$reply" =~ ^[Nn]$ ]]; then
        overwrite=false
      fi
    fi
    if [[ "$overwrite" = true ]] ; then
echo "$n"
      if [ -f "$n" ] ; then
        case "${n%,}" in
    *.tar.bz2|*.tbz2)	 tar xvjf ./"$n"    ;;
    *.tar.gz|*.tgz)	 tar xvzf ./"$n"    ;;
    *.tar.xz|*.txz|*.tar) tar xvf ./"$n"    ;;
          *.lzma)      unlzma ./"$n"      	;;
          *.bz2)       bunzip2 ./"$n"     	;;
          *.rar)       unrar x -ad ./"$n" 	;;
          *.gz)        gunzip ./"$n"      	;;
          *.zip)       unzip ./"$n"       	;;
          *.z|*.Z)     uncompress ./"$n"  	;;
          *.7z|*.arj|*.cab|*.chm|*.deb|*.dmg|*.iso|*.lzh|*.msi|*.rpm|*.udf|*.wim|*.xar)
         7z x ./"$n"		;;
          *.xz)        unxz ./"$n"		;;
          *.exe)       cabextract ./"$n"	;;
          *)
                       echo "extract: '$n' - unknown archive method"
                       return 1
                       ;;
        esac
      else
        echo "'$n' - file does not exist"
        return 1
      fi
    else
      echo "Not overwriting $n"
    fi
  done
fi

